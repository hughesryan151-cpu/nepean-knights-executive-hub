<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Nepean Knights â€“ Admin Approval</title>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>

<style>
body{margin:0;font-family:Arial,sans-serif;background:linear-gradient(135deg,#FFD200,#E41F26);color:#000;}
header{display:flex;justify-content:space-between;align-items:center;background:#E41F26;color:#FFD200;padding:10px 20px;}
header img{height:50px;}
header button{background:#FFD200;color:#000;border:none;padding:10px 15px;border-radius:6px;font-weight:bold;cursor:pointer;}
header button:hover{opacity:.9;}
main{padding:20px;}
h2{text-align:center;margin-bottom:20px;color:#E41F26;}
.card{background:#FFF2CC;border-radius:10px;padding:15px;margin-bottom:10px;box-shadow:0 2px 5px rgba(0,0,0,0.2);}
.card button{margin-right:10px;padding:5px 10px;border:none;border-radius:5px;font-weight:bold;cursor:pointer;}
.card button.approve{background:#E41F26;color:#FFD200;}
.card button.deny{background:#FFD200;color:#E41F26;}
.card button:hover{opacity:0.9;}
</style>
</head>
<body>

<header>
  <div style="display:flex;align-items:center;">
    <img src="nepean-knights-logo.png" alt="Logo">
    <h2 style="margin-left:10px;">Admin User Approvals</h2>
  </div>
  <button onclick="logout()">Logout</button>
</header>

<main>
  <h2>Pending Users</h2>
  <div id="pendingList">Loading...</div>
</main>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyAinnWRDZZae0fyeCM--CEhTaRvyOK8hD8",
  authDomain: "nepean-knights-executive-hub.firebaseapp.com",
  projectId: "nepean-knights-executive-hub",
  storageBucket: "nepean-knights-executive-hub.appspot.com",
  messagingSenderId: "103399385512",
  appId: "1:103399385512:web:bbd8ac65b5c8be5332159d"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

// Only allow admin to access
auth.onAuthStateChanged(async user=>{
  if(!user) window.location.href="index.html";
  const adminSnap = await db.collection('admins').where('email','==',user.email).get();
  if(adminSnap.empty){
    alert("Access denied. Admins only.");
    auth.signOut().then(()=>window.location.href="index.html");
  } else {
    loadPendingUsers();
  }
});

function logout(){ auth.signOut().then(()=>window.location.href="index.html"); }

// Load pending users
async function loadPendingUsers(){
  const container = document.getElementById('pendingList');
  const snap = await db.collection('users').where('approved','==',false).get();
  container.innerHTML = "";
  if(snap.empty){ container.innerHTML="No users pending approval."; return; }

  snap.forEach(doc=>{
    const data = doc.data();
    const div = document.createElement('div');
    div.className = "card";
    div.innerHTML = `
      <strong>${data.email}</strong><br>
      Name: ${data.name || 'N/A'}<br>
      <button class="approve">Approve</button>
      <button class="deny">Deny</button>
    `;
    container.appendChild(div);

    div.querySelector('.approve').addEventListener('click', ()=>approveUser(doc.id,data.email));
    div.querySelector('.deny').addEventListener('click', ()=>denyUser(doc.id,data.email));
  });
}

// Approve user
async function approveUser(docId,email){
  await db.collection('users').doc(docId).update({approved:true});
  // Also add to approvedUsers collection
  await db.collection('approvedUsers').add({email:email});
  alert(email + " approved!");
  loadPendingUsers();
}

// Deny user
async function denyUser(docId,email){
  if(!confirm("Are you sure you want to deny this user?")) return;
  await db.collection('users').doc(docId).delete();
  alert(email + " denied and removed.");
  loadPendingUsers();
}
</script>

</body>
</html>
