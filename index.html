<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Nepean Knights â€“ Executive Login</title>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
:root {
  --primary-color: #E41F26;
  --secondary-color: #FFD200;
  --accent-color: #000;
  --bg-color: #FFE680;
  --card-bg: #FFF2CC;
}
body {
  margin:0; font-family:Arial,sans-serif;
  background: linear-gradient(135deg,#FFD200,#E41F26);
  display:flex; justify-content:center; align-items:center; height:100vh;
}
.login-card {
  background-color: var(--card-bg);
  border-radius: 15px; padding: 40px 30px;
  box-shadow: 0 6px 20px rgba(0,0,0,0.3);
  text-align:center; width:350px;
}
.login-card img.logo {height:80px; margin-bottom:15px;}
.login-card h2 {color: var(--primary-color); margin-bottom:25px;}
.login-card input {width:100%; padding:12px; margin:10px 0; border-radius:6px; border:1px solid #ccc;}
.login-card button {width:100%; background-color: var(--secondary-color); color: var(--accent-color); padding:12px; margin-top:15px; border:none; border-radius:6px; cursor:pointer; font-weight:bold;}
.login-card button:hover{opacity:0.9;}
#errorMessage{color:red;margin-top:10px;font-weight:bold;}
</style>
</head>
<body>

<div class="login-card">
  <img src="nepean-knights-logo.png" alt="Nepean Knights Logo" class="logo">
  <h2>Executive Login</h2>
  <input type="email" id="email" placeholder="Email" required>
  <input type="password" id="password" placeholder="Password" required>
  <button onclick="login()">Login</button>
  <div id="errorMessage"></div>
</div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyAinnWRDZZae0fyeCM--CEhTaRvyOK8hD8",
  authDomain: "nepean-knights-executive-hub.firebaseapp.com",
  projectId: "nepean-knights-executive-hub",
  storageBucket: "nepean-knights-executive-hub.firebasestorage.app",
  messagingSenderId: "103399385512",
  appId: "1:103399385512:web:bbd8ac65b5c8be5332159d"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

async function login(){
  const email = document.getElementById("email").value.trim();
  const password = document.getElementById("password").value;
  const errorDiv = document.getElementById("errorMessage");
  errorDiv.textContent = "";

  try {
    const userCredential = await auth.signInWithEmailAndPassword(email,password);
    const user = userCredential.user;

    // Check if user is approved
    const approvedSnap = await db.collection('approvedUsers')
      .where('email','==',user.email)
      .get();

    if(approvedSnap.empty){
      errorDiv.textContent = "Your account is pending approval. Contact admin.";
      await auth.signOut();
      return;
    }

    // Approved, redirect to dashboard
    window.location.href = "dashboard.html";

  } catch(err){
    errorDiv.textContent = err.message;
  }
}

// Optional: redirect logged-in approved users automatically
auth.onAuthStateChanged(async user => {
  if(user){
    const approvedSnap = await db.collection('approvedUsers')
      .where('email','==',user.email)
      .get();
    if(!approvedSnap.empty){
      window.location.href="dashboard.html";
    } else {
      await auth.signOut();
    }
  }
});
</script>

</body>
</html>



